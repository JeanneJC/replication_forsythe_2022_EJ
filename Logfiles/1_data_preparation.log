----------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  D:\Dropbox\Research\Data\Replication\Forsythe 2021\Replication_games\Logfiles/1_data_preparation.log
  log type:  text
 opened on:  28 Jun 2023, 15:43:00

.  
. * load data
. use Data/cps_00038, clear

. 
. **
. 
. * 1. PANEL PREPARATION
. 
. * keep age 16-79 (as in the initial code, see YH_data_init, line 134)
. keep if age >= 16 & age < 79
(185,573 observations deleted)

. 
. * date
. gen year_str = string(year)

. gen month_str = string(month)

. gen date_str = year_str + "m" + month_str

. gen date = monthly( date_str, "YM" )

. drop *_str

. 
. * declare panel
. xtset cpsidp date, monthly
       panel variable:  cpsidp (unbalanced)
        time variable:  date, 1994m5 to 2019m12, but with gaps
                delta:  1 month

. order cpsidp date

. sort cpsidp date

. 
. * longitudinal sample
. gen n = 0

. replace n = 1 if L.empstat != .
(20,883,996 real changes made)

. 
. * Check age, sex, race matching
. * dummies for race
. decode race, gen(race_string)

. gen white = ( strpos(race_,"white")>0 )

. gen black = ( strpos(race_,"black")>0 )

. gen asian = ( strpos(race_,"asian")>0 )

. gen pacific = ( strpos(race_,"pacific")>0 )

. gen native  = ( strpos(race_,"hawaiian") + strpos(race_,"american") + strpos(race_,"aleut") + strpos(race_,"eskimo") > 0 )

. gen tmp = white + black + asian + native + pacific

. gen no_race = tmp == 0

. 
. * check
. tab race if white

                                   race |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                                  white | 24,735,435       98.81       98.81
                            white-black |     59,495        0.24       99.05
                  white-american indian |    148,013        0.59       99.64
                            white-asian |     47,989        0.19       99.83
        white-hawaiian/pacific islander |     16,123        0.06       99.90
            white-black-american indian |      9,875        0.04       99.94
                      white-black-asian |        922        0.00       99.94
            white-american indian-asian |      1,420        0.01       99.95
  white-asian-hawaiian/pacific islander |     12,343        0.05      100.00
      white-black-american indian-asian |        490        0.00      100.00
 white-black--hawaiian/pacific islander |        155        0.00      100.00
white-american indian-hawaiian/pacific  |        274        0.00      100.00
white-american indian-asian-hawaiian/pa |         57        0.00      100.00
----------------------------------------+-----------------------------------
                                  Total | 25,032,591      100.00

. tab race if black

                                   race |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                                  black |  2,993,318       97.00       97.00
                            white-black |     59,495        1.93       98.92
                  black-american indian |     16,660        0.54       99.46
                            black-asian |      3,953        0.13       99.59
        black-hawaiian/pacific islander |      1,074        0.03       99.63
            white-black-american indian |      9,875        0.32       99.95
                      white-black-asian |        922        0.03       99.98
      white-black-american indian-asian |        490        0.02       99.99
 white-black--hawaiian/pacific islander |        155        0.01      100.00
            black-american indian-asian |        102        0.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  3,086,044      100.00

. tab race if asian

                                   race |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
              asian or pacific islander |    371,907       26.83       26.83
                             asian only |    930,911       67.15       93.98
                            white-asian |     47,989        3.46       97.44
                            black-asian |      3,953        0.29       97.72
                  american indian-asian |      1,004        0.07       97.80
        asian-hawaiian/pacific islander |     15,208        1.10       98.89
                      white-black-asian |        922        0.07       98.96
            white-american indian-asian |      1,420        0.10       99.06
  white-asian-hawaiian/pacific islander |     12,343        0.89       99.95
      white-black-american indian-asian |        490        0.04       99.99
            black-american indian-asian |        102        0.01      100.00
white-american indian-asian-hawaiian/pa |         57        0.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  1,386,306      100.00

. tab race if native

                                   race |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
           american indian/aleut/eskimo |    353,468       53.77       53.77
         hawaiian/pacific islander only |     80,919       12.31       66.08
                  white-american indian |    148,013       22.52       88.60
        white-hawaiian/pacific islander |     16,123        2.45       91.05
                  black-american indian |     16,660        2.53       93.58
        black-hawaiian/pacific islander |      1,074        0.16       93.75
                  american indian-asian |      1,004        0.15       93.90
        asian-hawaiian/pacific islander |     15,208        2.31       96.21
            white-black-american indian |      9,875        1.50       97.72
            white-american indian-asian |      1,420        0.22       97.93
  white-asian-hawaiian/pacific islander |     12,343        1.88       99.81
      white-black-american indian-asian |        490        0.07       99.88
american indian-hawaiian/pacific island |        169        0.03       99.91
 white-black--hawaiian/pacific islander |        155        0.02       99.93
white-american indian-hawaiian/pacific  |        274        0.04       99.98
            black-american indian-asian |        102        0.02       99.99
white-american indian-asian-hawaiian/pa |         57        0.01      100.00
----------------------------------------+-----------------------------------
                                  Total |    657,354      100.00

. tab race if pacific

                                   race |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
              asian or pacific islander |    371,907       74.65       74.65
         hawaiian/pacific islander only |     80,919       16.24       90.89
        white-hawaiian/pacific islander |     16,123        3.24       94.12
        black-hawaiian/pacific islander |      1,074        0.22       94.34
        asian-hawaiian/pacific islander |     15,208        3.05       97.39
  white-asian-hawaiian/pacific islander |     12,343        2.48       99.87
american indian-hawaiian/pacific island |        169        0.03       99.90
 white-black--hawaiian/pacific islander |        155        0.03       99.93
white-american indian-hawaiian/pacific  |        274        0.05       99.99
white-american indian-asian-hawaiian/pa |         57        0.01      100.00
----------------------------------------+-----------------------------------
                                  Total |    498,229      100.00

. tab race if no_race

                                   race |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
             other (single) race, n.e.c |     29,486       89.15       89.15
        two or three races, unspecified |      2,489        7.53       96.68
        four or five races, unspecified |      1,098        3.32      100.00
----------------------------------------+-----------------------------------
                                  Total |     33,073      100.00

. 
. * identify mismatched based on sex, race , age
. gen mismatch = .
(29,834,357 missing values generated)

. replace mismatch = 0 if n == 1 
(20,883,996 real changes made)

. replace mismatch = 1 if n == 1 & ( sex != L.sex | race != L.race | age < L.age | age > L.age+1 )
(213,642 real changes made)

. 
. * sample longitudinally matched
. replace n = 0 if mismatch == 1
(213,642 real changes made)

. 
. * count number of mismatched per id
. by cpsidp, sort: egen sum_mismatch = sum(mismatch)

. tab sum_mismatch

sum_mismatc |
          h |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 | 28,811,464       96.57       96.57
          1 |    873,363        2.93       99.50
          2 |    118,929        0.40       99.90
          3 |     23,769        0.08       99.98
          4 |      4,939        0.02       99.99
          5 |      1,549        0.01      100.00
          6 |        344        0.00      100.00
------------+-----------------------------------
      Total | 29,834,357      100.00

. 
. * longitudinal weights
. gen weights = 1/2*(L.wtfinl + wtfinl)
(8,950,361 missing values generated)

. 
. * normalize by date
. by date, sort: egen w_sum = sum( weights )

. replace weights = weights / w_sum
(20,883,996 real changes made)

. 
. 
. ****
. ****
. 
. 
. * 2. ADDITIONAL VARIABLES
. 
. ** Potential experience
. 
. * years of education
. gen year_educ = 0

. 
. * primary/secondary school
. gen yeareduc = 0 if educ == 2 // none, preschool
(29,739,363 missing values generated)

. replace yeareduc = 4 if educ >= 10 & educ <= 14 // grade 4 and less
(191,266 real changes made)

. replace yeareduc = 6 if educ >= 20 & educ <= 22 // grade 5 and 6
(383,712 real changes made)

. replace yeareduc = 8 if educ >= 30 & educ <= 32 // grade 7 and 8
(630,703 real changes made)

. replace yeareduc = 9 if educ == 40 // grade 9
(705,044 real changes made)

. replace yeareduc = 10 if educ == 50 // grade 10
(1,123,286 real changes made)

. replace yeareduc = 11 if educ == 60 // grade 11
(1,235,923 real changes made)

. replace yeareduc = 12 if educ >= 71 & educ <= 73 // grade 12/high school diploma
(9,525,455 real changes made)

. 
. * higher education
. replace yeareduc = 13 if educ == 81                             // some college
(5,542,484 real changes made)

. replace yeareduc = 14 if educ >= 91 & educ <= 92        // AD
(2,538,003 real changes made)

. replace yeareduc = 16 if educ == 111                            // Bachelor
(5,172,977 real changes made)

. replace yeareduc = 18 if educ == 123                            // Master's
(1,927,096 real changes made)

. replace yeareduc = 20 if educ == 124                            // PD
(394,430 real changes made)

. replace yeareduc = 22 if educ == 125                            // PhD
(368,984 real changes made)

. by yeareduc, sort: tab educ, miss

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 0

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                      none or preschool |     94,994      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |     94,994      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 4

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                   grades 1, 2, 3, or 4 |    191,266      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |    191,266      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 6

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                          grades 5 or 6 |    383,712      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |    383,712      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 8

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                          grades 7 or 8 |    630,703      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |    630,703      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 9

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                                grade 9 |    705,044      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |    705,044      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 10

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                               grade 10 |  1,123,286      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  1,123,286      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 11

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                               grade 11 |  1,235,923      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  1,235,923      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 12

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                 12th grade, no diploma |    439,676        4.62        4.62
      high school diploma or equivalent |  9,085,779       95.38      100.00
----------------------------------------+-----------------------------------
                                  Total |  9,525,455      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 13

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
             some college but no degree |  5,542,484      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  5,542,484      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 14

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
associate's degree, occupational/vocati |  1,260,675       49.67       49.67
   associate's degree, academic program |  1,277,328       50.33      100.00
----------------------------------------+-----------------------------------
                                  Total |  2,538,003      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 16

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                      bachelor's degree |  5,172,977      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  5,172,977      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 18

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                        master's degree |  1,927,096      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  1,927,096      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 20

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
             professional school degree |    394,430      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |    394,430      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> yeareduc = 22

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                       doctorate degree |    368,984      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |    368,984      100.00


. 
. * check
. by educ, sort: tab yeareduc, miss

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = none or

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |     94,994      100.00      100.00
------------+-----------------------------------
      Total |     94,994      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = grades 1

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
          4 |    191,266      100.00      100.00
------------+-----------------------------------
      Total |    191,266      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = grades 5

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
          6 |    383,712      100.00      100.00
------------+-----------------------------------
      Total |    383,712      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = grades 7

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
          8 |    630,703      100.00      100.00
------------+-----------------------------------
      Total |    630,703      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = grade 9

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
          9 |    705,044      100.00      100.00
------------+-----------------------------------
      Total |    705,044      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = grade 10

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         10 |  1,123,286      100.00      100.00
------------+-----------------------------------
      Total |  1,123,286      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = grade 11

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         11 |  1,235,923      100.00      100.00
------------+-----------------------------------
      Total |  1,235,923      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = 12th gra

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         12 |    439,676      100.00      100.00
------------+-----------------------------------
      Total |    439,676      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = high sch

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         12 |  9,085,779      100.00      100.00
------------+-----------------------------------
      Total |  9,085,779      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = some col

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         13 |  5,542,484      100.00      100.00
------------+-----------------------------------
      Total |  5,542,484      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = associat

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         14 |  1,260,675      100.00      100.00
------------+-----------------------------------
      Total |  1,260,675      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = associat

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         14 |  1,277,328      100.00      100.00
------------+-----------------------------------
      Total |  1,277,328      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = bachelor

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         16 |  5,172,977      100.00      100.00
------------+-----------------------------------
      Total |  5,172,977      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = master's

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         18 |  1,927,096      100.00      100.00
------------+-----------------------------------
      Total |  1,927,096      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = professi

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         20 |    394,430      100.00      100.00
------------+-----------------------------------
      Total |    394,430      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educ = doctorat

   yeareduc |      Freq.     Percent        Cum.
------------+-----------------------------------
         22 |    368,984      100.00      100.00
------------+-----------------------------------
      Total |    368,984      100.00


. 
. * compute potential experience
. gen exp = max( age - yeareduc - 6, 0) // experience with imputed zero

. gen exp_neg_val = age - yeareduc - 6  // experience with negative values

. 
. * check
. tab exp, missing

        exp |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,362,137        4.57        4.57
          1 |  1,143,119        3.83        8.40
          2 |    739,218        2.48       10.87
          3 |    607,056        2.03       12.91
          4 |    552,730        1.85       14.76
          5 |    531,653        1.78       16.54
          6 |    527,448        1.77       18.31
          7 |    525,333        1.76       20.07
          8 |    525,124        1.76       21.83
          9 |    523,282        1.75       23.59
         10 |    526,912        1.77       25.35
         11 |    532,125        1.78       27.14
         12 |    539,695        1.81       28.95
         13 |    539,357        1.81       30.75
         14 |    538,604        1.81       32.56
         15 |    544,040        1.82       34.38
         16 |    552,788        1.85       36.24
         17 |    558,489        1.87       38.11
         18 |    564,705        1.89       40.00
         19 |    564,853        1.89       41.89
         20 |    572,273        1.92       43.81
         21 |    577,679        1.94       45.75
         22 |    585,234        1.96       47.71
         23 |    581,251        1.95       49.66
         24 |    582,064        1.95       51.61
         25 |    582,472        1.95       53.56
         26 |    581,048        1.95       55.51
         27 |    575,836        1.93       57.44
         28 |    572,009        1.92       59.36
         29 |    564,609        1.89       61.25
         30 |    559,373        1.87       63.12
         31 |    551,940        1.85       64.97
         32 |    548,415        1.84       66.81
         33 |    531,947        1.78       68.59
         34 |    517,181        1.73       70.33
         35 |    506,413        1.70       72.03
         36 |    495,053        1.66       73.69
         37 |    481,391        1.61       75.30
         38 |    471,147        1.58       76.88
         39 |    453,943        1.52       78.40
         40 |    439,083        1.47       79.87
         41 |    424,913        1.42       81.30
         42 |    410,532        1.38       82.67
         43 |    394,549        1.32       83.99
         44 |    379,607        1.27       85.27
         45 |    363,863        1.22       86.49
         46 |    351,997        1.18       87.67
         47 |    342,230        1.15       88.81
         48 |    326,532        1.09       89.91
         49 |    309,746        1.04       90.95
         50 |    298,851        1.00       91.95
         51 |    285,424        0.96       92.90
         52 |    275,566        0.92       93.83
         53 |    261,658        0.88       94.70
         54 |    250,523        0.84       95.54
         55 |    231,810        0.78       96.32
         56 |    222,927        0.75       97.07
         57 |    192,156        0.64       97.71
         58 |    183,062        0.61       98.33
         59 |    168,485        0.56       98.89
         60 |    132,306        0.44       99.33
         61 |     52,489        0.18       99.51
         62 |     44,102        0.15       99.66
         63 |     35,461        0.12       99.78
         64 |     28,055        0.09       99.87
         65 |     11,224        0.04       99.91
         66 |     10,472        0.04       99.94
         67 |      5,326        0.02       99.96
         68 |      5,274        0.02       99.98
         69 |      1,610        0.01       99.98
         70 |      1,555        0.01       99.99
         71 |      1,567        0.01      100.00
         72 |      1,456        0.00      100.00
------------+-----------------------------------
      Total | 29,834,357      100.00

. tab exp_neg_val, missing

exp_neg_val |      Freq.     Percent        Cum.
------------+-----------------------------------
        -12 |         34        0.00        0.00
        -11 |         16        0.00        0.00
        -10 |         76        0.00        0.00
         -9 |         64        0.00        0.00
         -8 |        248        0.00        0.00
         -7 |        270        0.00        0.00
         -6 |      1,069        0.00        0.01
         -5 |      1,143        0.00        0.01
         -4 |      2,295        0.01        0.02
         -3 |      7,226        0.02        0.04
         -2 |     25,518        0.09        0.13
         -1 |    229,911        0.77        0.90
          0 |  1,094,267        3.67        4.57
          1 |  1,143,119        3.83        8.40
          2 |    739,218        2.48       10.87
          3 |    607,056        2.03       12.91
          4 |    552,730        1.85       14.76
          5 |    531,653        1.78       16.54
          6 |    527,448        1.77       18.31
          7 |    525,333        1.76       20.07
          8 |    525,124        1.76       21.83
          9 |    523,282        1.75       23.59
         10 |    526,912        1.77       25.35
         11 |    532,125        1.78       27.14
         12 |    539,695        1.81       28.95
         13 |    539,357        1.81       30.75
         14 |    538,604        1.81       32.56
         15 |    544,040        1.82       34.38
         16 |    552,788        1.85       36.24
         17 |    558,489        1.87       38.11
         18 |    564,705        1.89       40.00
         19 |    564,853        1.89       41.89
         20 |    572,273        1.92       43.81
         21 |    577,679        1.94       45.75
         22 |    585,234        1.96       47.71
         23 |    581,251        1.95       49.66
         24 |    582,064        1.95       51.61
         25 |    582,472        1.95       53.56
         26 |    581,048        1.95       55.51
         27 |    575,836        1.93       57.44
         28 |    572,009        1.92       59.36
         29 |    564,609        1.89       61.25
         30 |    559,373        1.87       63.12
         31 |    551,940        1.85       64.97
         32 |    548,415        1.84       66.81
         33 |    531,947        1.78       68.59
         34 |    517,181        1.73       70.33
         35 |    506,413        1.70       72.03
         36 |    495,053        1.66       73.69
         37 |    481,391        1.61       75.30
         38 |    471,147        1.58       76.88
         39 |    453,943        1.52       78.40
         40 |    439,083        1.47       79.87
         41 |    424,913        1.42       81.30
         42 |    410,532        1.38       82.67
         43 |    394,549        1.32       83.99
         44 |    379,607        1.27       85.27
         45 |    363,863        1.22       86.49
         46 |    351,997        1.18       87.67
         47 |    342,230        1.15       88.81
         48 |    326,532        1.09       89.91
         49 |    309,746        1.04       90.95
         50 |    298,851        1.00       91.95
         51 |    285,424        0.96       92.90
         52 |    275,566        0.92       93.83
         53 |    261,658        0.88       94.70
         54 |    250,523        0.84       95.54
         55 |    231,810        0.78       96.32
         56 |    222,927        0.75       97.07
         57 |    192,156        0.64       97.71
         58 |    183,062        0.61       98.33
         59 |    168,485        0.56       98.89
         60 |    132,306        0.44       99.33
         61 |     52,489        0.18       99.51
         62 |     44,102        0.15       99.66
         63 |     35,461        0.12       99.78
         64 |     28,055        0.09       99.87
         65 |     11,224        0.04       99.91
         66 |     10,472        0.04       99.94
         67 |      5,326        0.02       99.96
         68 |      5,274        0.02       99.98
         69 |      1,610        0.01       99.98
         70 |      1,555        0.01       99.99
         71 |      1,567        0.01      100.00
         72 |      1,456        0.00      100.00
------------+-----------------------------------
      Total | 29,834,357      100.00

. 
. * flag exp variable for negative values
. gen exp_flag = (exp_neg_val <= 0 & exp_neg_val != .)

. 
. * experience groups
. gen exp_group = 0 if exp !=.

. replace exp_group = 1 if exp <= 10 & exp != .
(7,564,012 real changes made)

. label def exp_lab 1 "PE $\leq$ 10" 0 "PE $>$ 10" 

. label values exp_group exp_lab

. 
. 
. **
. 
. ** education groups
. gen educgroup = 0 if educ >= 0 & educ <= 71  //no hs degree
(25,029,753 missing values generated)

. replace educgroup = 1 if educ == 73 // hs 
(9,085,779 real changes made)

. replace educgroup = 2 if educ == 81 // some college
(5,542,484 real changes made)

. replace educg =  3 if educ >= 91 & educ <= 111 // college deg.
(7,710,980 real changes made)

. replace educg = 4 if educ == 123 //masters
(1,927,096 real changes made)

. replace educg = 5 if educ == 124 //prof deg
(394,430 real changes made)

. replace educg = 6 if educ == 125 //phd
(368,984 real changes made)

. by educg, sort: tab educ

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = 0

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                      none or preschool |     94,994        1.98        1.98
                   grades 1, 2, 3, or 4 |    191,266        3.98        5.96
                          grades 5 or 6 |    383,712        7.99       13.94
                          grades 7 or 8 |    630,703       13.13       27.07
                                grade 9 |    705,044       14.67       41.75
                               grade 10 |  1,123,286       23.38       65.13
                               grade 11 |  1,235,923       25.72       90.85
                 12th grade, no diploma |    439,676        9.15      100.00
----------------------------------------+-----------------------------------
                                  Total |  4,804,604      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = 1

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
      high school diploma or equivalent |  9,085,779      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  9,085,779      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = 2

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
             some college but no degree |  5,542,484      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  5,542,484      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = 3

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
associate's degree, occupational/vocati |  1,260,675       16.35       16.35
   associate's degree, academic program |  1,277,328       16.57       32.91
                      bachelor's degree |  5,172,977       67.09      100.00
----------------------------------------+-----------------------------------
                                  Total |  7,710,980      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = 4

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                        master's degree |  1,927,096      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  1,927,096      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = 5

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
             professional school degree |    394,430      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |    394,430      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = 6

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                       doctorate degree |    368,984      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |    368,984      100.00


. 
. * labels
. label define educ_lab 0 "no hs degree" 1 "hs" 2 "some college" 3 "college degree" 4 "masters" 5 "prof. degree" 6 "PhD"

. label values educgroup educ_lab

. 
. 
. **
. 
. 
. ** demographic dummy set (gender/race (white, nonwhite)/hispanic origin/education group)
. egen demographic = group(sex white hispan educg)

. 
. * checks
. by educgroup, sort: tab educ, miss

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = no hs degree

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                      none or preschool |     94,994        1.98        1.98
                   grades 1, 2, 3, or 4 |    191,266        3.98        5.96
                          grades 5 or 6 |    383,712        7.99       13.94
                          grades 7 or 8 |    630,703       13.13       27.07
                                grade 9 |    705,044       14.67       41.75
                               grade 10 |  1,123,286       23.38       65.13
                               grade 11 |  1,235,923       25.72       90.85
                 12th grade, no diploma |    439,676        9.15      100.00
----------------------------------------+-----------------------------------
                                  Total |  4,804,604      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = hs

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
      high school diploma or equivalent |  9,085,779      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  9,085,779      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = some college

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
             some college but no degree |  5,542,484      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  5,542,484      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = college degree

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
associate's degree, occupational/vocati |  1,260,675       16.35       16.35
   associate's degree, academic program |  1,277,328       16.57       32.91
                      bachelor's degree |  5,172,977       67.09      100.00
----------------------------------------+-----------------------------------
                                  Total |  7,710,980      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = masters

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                        master's degree |  1,927,096      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |  1,927,096      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = prof. degree

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
             professional school degree |    394,430      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |    394,430      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> educgroup = PhD

          educational attainment recode |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                       doctorate degree |    368,984      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |    368,984      100.00


. by exp_group, sort: tab exp, miss

----------------------------------------------------------------------------------------------------------------------------------------------
-> exp_group = PE $>$ 10

        exp |      Freq.     Percent        Cum.
------------+-----------------------------------
         11 |    532,125        2.39        2.39
         12 |    539,695        2.42        4.81
         13 |    539,357        2.42        7.23
         14 |    538,604        2.42        9.65
         15 |    544,040        2.44       12.10
         16 |    552,788        2.48       14.58
         17 |    558,489        2.51       17.09
         18 |    564,705        2.54       19.62
         19 |    564,853        2.54       22.16
         20 |    572,273        2.57       24.73
         21 |    577,679        2.59       27.32
         22 |    585,234        2.63       29.95
         23 |    581,251        2.61       32.56
         24 |    582,064        2.61       35.17
         25 |    582,472        2.62       37.79
         26 |    581,048        2.61       40.40
         27 |    575,836        2.59       42.98
         28 |    572,009        2.57       45.55
         29 |    564,609        2.54       48.09
         30 |    559,373        2.51       50.60
         31 |    551,940        2.48       53.08
         32 |    548,415        2.46       55.54
         33 |    531,947        2.39       57.93
         34 |    517,181        2.32       60.25
         35 |    506,413        2.27       62.52
         36 |    495,053        2.22       64.75
         37 |    481,391        2.16       66.91
         38 |    471,147        2.12       69.02
         39 |    453,943        2.04       71.06
         40 |    439,083        1.97       73.03
         41 |    424,913        1.91       74.94
         42 |    410,532        1.84       76.79
         43 |    394,549        1.77       78.56
         44 |    379,607        1.70       80.26
         45 |    363,863        1.63       81.90
         46 |    351,997        1.58       83.48
         47 |    342,230        1.54       85.01
         48 |    326,532        1.47       86.48
         49 |    309,746        1.39       87.87
         50 |    298,851        1.34       89.21
         51 |    285,424        1.28       90.49
         52 |    275,566        1.24       91.73
         53 |    261,658        1.17       92.91
         54 |    250,523        1.12       94.03
         55 |    231,810        1.04       95.07
         56 |    222,927        1.00       96.07
         57 |    192,156        0.86       96.94
         58 |    183,062        0.82       97.76
         59 |    168,485        0.76       98.51
         60 |    132,306        0.59       99.11
         61 |     52,489        0.24       99.34
         62 |     44,102        0.20       99.54
         63 |     35,461        0.16       99.70
         64 |     28,055        0.13       99.83
         65 |     11,224        0.05       99.88
         66 |     10,472        0.05       99.92
         67 |      5,326        0.02       99.95
         68 |      5,274        0.02       99.97
         69 |      1,610        0.01       99.98
         70 |      1,555        0.01       99.99
         71 |      1,567        0.01       99.99
         72 |      1,456        0.01      100.00
------------+-----------------------------------
      Total | 22,270,345      100.00

----------------------------------------------------------------------------------------------------------------------------------------------
-> exp_group = PE $\leq$ 10

        exp |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,362,137       18.01       18.01
          1 |  1,143,119       15.11       33.12
          2 |    739,218        9.77       42.89
          3 |    607,056        8.03       50.92
          4 |    552,730        7.31       58.23
          5 |    531,653        7.03       65.26
          6 |    527,448        6.97       72.23
          7 |    525,333        6.95       79.17
          8 |    525,124        6.94       86.12
          9 |    523,282        6.92       93.03
         10 |    526,912        6.97      100.00
------------+-----------------------------------
      Total |  7,564,012      100.00


. sort cpsidp date

. 
. 
. **
. 
. ** LAUS unemployment rate by state
. merge m:1 statefip year month using Data/laus_state_wide, keepusing(unemp_rate)

    Result                           # of obs.
    -----------------------------------------
    not matched                        13,828
        from master                         0  (_merge==1)
        from using                     13,828  (_merge==2)

    matched                        29,834,357  (_merge==3)
    -----------------------------------------

. 
. * check the non merged
. tab year if _merge == 2

survey year |      Freq.     Percent        Cum.
------------+-----------------------------------
       1976 |        624        4.51        4.51
       1977 |        624        4.51        9.03
       1978 |        624        4.51       13.54
       1979 |        624        4.51       18.05
       1980 |        624        4.51       22.56
       1981 |        624        4.51       27.08
       1982 |        624        4.51       31.59
       1983 |        624        4.51       36.10
       1984 |        624        4.51       40.61
       1985 |        624        4.51       45.13
       1986 |        624        4.51       49.64
       1987 |        624        4.51       54.15
       1988 |        624        4.51       58.66
       1989 |        624        4.51       63.18
       1990 |        624        4.51       67.69
       1991 |        624        4.51       72.20
       1992 |        624        4.51       76.71
       1993 |        624        4.51       81.23
       1994 |        216        1.56       82.79
       1995 |         12        0.09       82.88
       1996 |         12        0.09       82.96
       1997 |         12        0.09       83.05
       1998 |         12        0.09       83.14
       1999 |         12        0.09       83.22
       2000 |         12        0.09       83.31
       2001 |         12        0.09       83.40
       2002 |         12        0.09       83.48
       2003 |         12        0.09       83.57
       2004 |         12        0.09       83.66
       2005 |         12        0.09       83.74
       2006 |         12        0.09       83.83
       2007 |         12        0.09       83.92
       2008 |         12        0.09       84.00
       2009 |         12        0.09       84.09
       2010 |         12        0.09       84.18
       2011 |         12        0.09       84.26
       2012 |         12        0.09       84.35
       2013 |         12        0.09       84.44
       2014 |         12        0.09       84.52
       2015 |         12        0.09       84.61
       2016 |         12        0.09       84.70
       2017 |         12        0.09       84.78
       2018 |         12        0.09       84.87
       2019 |         12        0.09       84.96
       2020 |        624        4.51       89.47
       2021 |        624        4.51       93.98
       2022 |        624        4.51       98.50
       2023 |        208        1.50      100.00
------------+-----------------------------------
      Total |     13,828      100.00

. tab statefip if year >= 1995 & year <= 2019 & _mer == 2

                      state (fips code) |      Freq.     Percent        Cum.
----------------------------------------+-----------------------------------
                         minnesota-iowa |        300      100.00      100.00
----------------------------------------+-----------------------------------
                                  Total |        300      100.00

. drop if _merge == 2  // dropping data before 1995 and 2019 & minesotta-iowa
(13,828 observations deleted)

. drop _merge

. 
. * rename and label unemployment rate variable
. rename unemp_rate urate

. label var urate "U.\ rate"

. 
. 
. **
. 
. 
. ** Unemployment rate by MSA (estimated using the CPS)
. 
. * individual unemployment and lab force dummies
. gen unemployed = ( empstat >= 21 & empstat <= 22 ) // unem. dummy

. gen participant = ( empstat >= 10 & empstat <= 22 ) 

. 
. * collapse to compute unemployment
. preserve

. keep if metarea >= 60 & metarea <= 9360  // keep data for hh in metro area, with available msa info
(8,432,147 observations deleted)

. collapse (sum) u = unemployed (sum) p = participant (sum) n_msa = n [w = wtfinl], by(metarea date)
(analytic weights assumed)

. gen urate_msa = u / p * 100
(4 missing values generated)

. drop u p

. save tmp, replace
(note: file tmp.dta not found)
file tmp.dta saved

. restore

. merge m:1 metarea date using tmp
(label METAREA already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                     8,432,147
        from master                 8,432,147  (_merge==1)
        from using                          0  (_merge==2)

    matched                        21,402,210  (_merge==3)
    -----------------------------------------

. drop _merge 

. erase tmp.dta

. 
. 
. **
. 
. 
. ** Dependent variable for hiring
. sort cpsidp date

. gen d_hired = 0

. replace d_hired = 100 if (empstat >= 10 & empstat <= 12) & (L.empstat >= 21 & L.empstat <= 36)                            // hired from none
> mployement
(523,097 real changes made)

. replace d_hired = 100 if (empstat >= 10 & empstat <= 12) & (L.empstat >= 10 & L.empstat <= 12) & empsame == 1 // hired from another job
(295,699 real changes made)

. replace d_hired = 0 if d_hired == 100 & (classwkr >= 13 & classwkr <= 14)                                                                   
>       // exclude transitions to self-employment
(100,395 real changes made)

. 
. ** Sample 1994-2014
. gen sample = (year >= 1994 & year <= 2014)

. replace sample = 0 if ( year == 1995 & ( month >= 5 & month <= 8 ) ) 
(403,617 real changes made)

. replace sample = 0 if ( year == 2014 & month > 6 )
(599,475 real changes made)

. replace sample = 0 if n == 0
(6,933,458 real changes made)

. 
. ** Sample 1994-2019
. gen sample_2019 = (year >= 1994 & year <= 2019)

. replace sample_2019 = 0 if ( year == 1995 & ( month >= 5 & month <= 8 ) ) 
(403,617 real changes made)

. replace sample_2019 = 0 if n == 0
(8,833,080 real changes made)

. 
. 
. **
. 
. * save intermediate dataset
. save Data/intermediate_data, replace
file Data/intermediate_data.dta saved

. 
. 
. **
. 
. * 3. SAVE FINAL DATASETS
. 
. use Data/intermediate_data, clear

. 
. #delimit ;
delimiter now ;
. global variables = "cpsidp date year month statefip metfips metarea age sex race hispan educgroup empstat classwkr empsame
>                                     sample sample_2019 weights d_hired urate exp exp_neg exp_flag exp_group urate_msa n_msa demographic whyu
> nemp
>                                         eligorg earnweek_cpiu_2010 occ1990 ind1990 qearn";

. #delimit cr
delimiter now cr
. 
. di "$variables"
cpsidp date year month statefip metfips metarea age sex race hispan educgroup empstat classwkr empsame                                     sam
> ple sample_2019 weights d_hired urate exp exp_neg exp_flag exp_group urate_msa n_msa demographic whyunemp                                   
>       eligorg earnweek_cpiu_2010 occ1990 ind1990 qearn

. 
. * save dataset                            
. keep $variables

. compress
  variable date was float now int
  variable exp was float now byte
  variable exp_neg_val was float now byte
  variable exp_flag was float now byte
  variable exp_group was float now byte
  variable educgroup was float now byte
  variable demographic was float now int
  variable d_hired was float now byte
  variable sample was float now byte
  variable sample_2019 was float now byte
  (835,361,996 bytes saved)

. saveold Data/final_dataset, replace
(saving in Stata 13 format)
(FYI, saveold has options version(12) and version(11) that write files in older Stata formats)
file Data/final_dataset.dta saved

. macro drop variables

. 
. **
. 
. log close 
      name:  <unnamed>
       log:  D:\Dropbox\Research\Data\Replication\Forsythe 2021\Replication_games\Logfiles/1_data_preparation.log
  log type:  text
 closed on:  28 Jun 2023, 16:02:43
----------------------------------------------------------------------------------------------------------------------------------------------
